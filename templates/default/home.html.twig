{% extends 'base.html.twig' %}

{% block body %}
	<div class="container">
		<div class="row">
			<div class="col-3" style='border: 5px; padding: 20px; background-color: #3B5145;'>
				<h3 style="color: white;">Recherche</h3>

				{# {{ form_start(form, {attr: {class: 'filter js-filter-form'}}) }} 
																																																								    <div class="spinner-border js-loading" role="status" aria-hidden="true" style="display: none">
																																																								    <span class="sr-only">Loading...</span>  </div>
																																																								
																																																								            {{ form_row(form.q) }}
																																																								           <h4>Catégories</h4>
																																																								            {{ form_row(form.categories) }}
																																																								            <button type="submit" class="btn btn-primary w-100">Filtrer</button>
																																																								            {{ form_end(form) }} #}
			</div>

			<div class="col-9" style='border: 5px; padding: 20px; background-color: #D5F5E3;'>
				<section class="articles">
					{% for article in articles %}
						<hr>
						<article>
							<h3>{{article.title}}</h3>
							<h5>{{article.subtitle}}</h5>
							{# <div class="metadate">Ecrit le {{article.creationDate | date('d/m/Y')}} à {{article.creationDate | date('H:i')}} dans la categorie: {{article.category.name}}</div> #}
							<div class="metadate">Ecrit le
								{{article.creationDate | date('d/m/Y')}},
								{% if article.autor != null  %}
									by
									{{article.autor.firstname}}
									{{article.autor.lastname}}
								{% else %}
									by unknown user
								{% endif %}
								à
								{{article.creationDate | date('H:i')}}, 
																																																																																																																                Categorie:
								{{article.category.name}}
							</div>
							<div class="row">
								<div class="col-md-3">
									<img src='{{article.picturePath}}' , style="width:200px;height:130px;">
								</div>
								<div class="col-md-9">
									{{article.content | raw}}
									{# <a href="{{path('default_show', {'id': article.id})}}" class="btn btn-outline-info">... Lire la suite</a> #}
								</div>
							</div>
							<div class="socials">

								
								<div onclick="interact({{article.id}} , {{ app.user != null? app.user.id : 'null' }} , 0 , this )" class="social" ">
									<span  class="social_tag">

										{{ article.interactions |filter(v => v.interactionType == 0 )|length }}
										{# an error with   constant('App\\Entity\\Article::LIKE')) |length  }}     #}

									</span>
									<svg class="social_icon">
										<use xlink:href="#like"></use>
									</svg>
								</div>
								<div onclick="interact({{article.id}} , {{ app.user != null? app.user.id : 'null' }} , 1 ,this )" class="social">
									<span class="social_tag">
										{{ article.interactions |filter(v => v.interactionType == 1 )|length }}
										{# an error with   constant('App\\Entity\\Article::LIKE')) |length  }}     #}
									</span>
									<svg class="social_icon">
										<use xlink:href="#comment"></use>
									</svg>
								</div>
							</div>

						</article>
					{% endfor %}

				</section>

				<hr>
				{# <div class="pagination float-center"> 
				 {{knp_pagination_render(articles)}}
				</div> #}


			</div>
			<script>
				async function interact(article_id, user_id,interactionType,element) {
					
					console.log(element);
					number=Number.parseInt(element.children[0].innerText) ;
					
					var url = Routing.generate('article_interact',
						{
							'id': article_id
						});

						let content = {
						user: user_id,
						interact_type: interactionType,
					};

					if (user_id != null) {
				
						let response = await fetch(url,
						{
							method: "POST",
							body: JSON.stringify(content)
						});
					
						liked = await response.json();
						if(liked['action']=='add'&&liked['state']==true){
							number+=1;
						}else if(liked['action']=='remove'&&liked['state']==true){
							number-=1;
						}
						element.children[0].innerText=number;
						}else{
							console.log('veuillez vous connectez')
						}

				}
			</script>

		</div>


	</div>
{% endblock %}
{% block stylesheets %}
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link href="{{ asset('css/article/home.css') }}" rel="stylesheet"/>
{% endblock %}
